I"¨ü<h1 id="descripci√≥n-general-cat√°logo-de-im√°genes-satelitales-a-escala-regional">Descripci√≥n general: Cat√°logo de im√°genes satelitales a escala regional</h1>
<p>La mayor√≠a de los productos satelitales se dividen en bloques para su distribuci√≥n. Los datos globales de Landsat se dividen en escenas de ~180 km<sup>2</sup>, con identificadores √∫nicos de path/row. <em><a href="https://www.sciencedirect.com/science/article/abs/pii/S0034425715302194" target="_blank">Wulder et al. (2016)</a></em> sugieren  que cada escena es fotografiada cada 16 d√≠as por Landsat 8 y cada 16 d√≠as por Landsat 7 (aproximadamente 45 veces al a√±o). Los bordes de cada trayectoria se superponen, proporcionando una mayor frecuencia temporal en estas √°reas. Sin embargo, los cielos nublados durante el paso de los sat√©lites y otras anomal√≠as de adquisici√≥n hacen que ciertas escenas o p√≠xeles sean inutilizables.</p>

<p><img src="../fig/03_worldLandsat.png" width="100%" height="100%" />
<sub><em>USGS Landsat archive holdings as of January 1, 2015 (Wulder et al. (2016)).</em></sub>
<!--
<img src="https://3c1703fe8d.site.internapcdn.net/newman/gfx/news/hires/2013/76fuygfd.gif" width="100%" height="100%" />
<sub>*Forest loss in Sumatra's Riau province, Indonesia, 2000-2012. Credit: Hansen, Potapov, Moore, Hancher et al., 2013*</sub>
-->
<br />
<!--**455 escenas de Landsat cubren los Estados Unidos:**-->
<br />
<img src="../fig/03_MeanderCutTumbesRiver.gif" border="10" />
<br /><br /></p>

<p><br />
<!--**455 escenas de Landsat cubren los Estados Unidos:**-->
<br />
<img src="../fig/03_IlegalMiningAndMeanderMigration.gif" border="10" />
<br /><br /></p>

<p>Para la mayor√≠a de las aplicaciones a escala regional, se tendr√° que combinar m√∫ltiples im√°genes de sat√©lite para cubrir completamente su extensi√≥n espacial y completar los datos faltantes causados por las nubes, etc. Google Earth Engine (GEE) es particularmente adecuado para estas tareas.</p>

<!--

# Ejericio: Flujo b√°sico de trabajo GEE
Aqu√≠, aprovecharemos GEE para crear un composite que represente el pico de la temporada de crecimiento de cultivos para una cuenca de inter√©s.


### Image Collections
Una pila o serie temporal de im√°genes se llaman `Image Collections`. Cada fuente de datos disponible en GEE tiene su propia Image Collection y su propio ID (por ejemplo, el [Landsat 5 SR collection](https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C01_T1_SR), o la [GRIDMET meteorological data collection](https://code.earthengine.google.com/dataset/IDAHO_EPSCOR/GRIDMET)). Tambi√©n se puede crear Image Collection a partir de im√°genes individuales o fusionar colecciones existentes. Puede encontrar m√°s informaci√≥n sobre las Image Collection [here in the GEE Developer's Guide](https://developers.google.com/earth-engine/ic_creating).

Para generar im√°genes que cubran grandes √°reas espaciales y para llenar los huecos de imagen debidos a las nubes, etc., podemos cargar una `ImageCollection` completa, pero filtrar la colecci√≥n para devolver s√≥lo los per√≠odos de tiempo o las ubicaciones espaciales que sean de inter√©s. Hay filtros de acceso directo para los que se utilizan com√∫nmente (imageCollection.filterDate(), imageCollection.filterBounds()...), pero pueden utilizarse la mayor√≠a de los filtros de la secci√≥n `ee.Filter()` de la pesta√±a Docs. M√°s informaci√≥n sobre [filters on the Developer's Guide](https://developers.google.com/earth-engine/ic_filtering).

### Cargar archivos vectoriales
Trabajaremos en la creaci√≥n de un composite para una cuenca de los EE.UU. La forma m√°s f√°cil de filtrar una ubicaci√≥n irregular sin tener que identificar las rutas y filas de los mosaicos de la imagen satelital es usar un pol√≠gono vectorial.

Hay tres maneras de obtener datos de vectores en GEE:

  * [Cargar un shapefile](https://developers.google.com/earth-engine/importing) directamente a su carpeta personal *Asset* en el panel superior izquierdo. Puedes crear subcarpetas y establecer permisos para compartir seg√∫n sea necesario. Utilizamos un archivo vectorial Asset en el [modulo Accediendo al cat√°logo de im√°genes de sat√©lite](https://hasencios.github.io/GEE_BASICO_SENAMHI/03-load-imagery/).
  * Utilizar un conjunto de datos de vectores existente en GEE. [Navegue por el cat√°logo de datos vectoriales aqu√≠](https://developers.google.com/earth-engine/vector_datasets).
  * Dibuje manualmente puntos, l√≠neas y pol√≠gonos usando las herramientas de geometr√≠a del Code Editor. Haremos esto en el [Modulo de Clasificaci√≥n Supervisada de Im√°genes de Sat√©lite](https://hasencios.github.io/GEE_BASICO_SENAMHI/05-classify-imagery/).

Aqu√≠, usaremos un activo vectorial existente, el [USGS Watershed Boundaries - HUC12](https://code.earthengine.google.com/dataset/USGS/WBD/2017/HUC12)

Para cargar un archivo vectorial de sus Assets en su espacio de trabajo, necesitamos usar el "filepath" y lanzarlo a un tipo de datos `ee.FeatureCollection`. Lee m√°s aqu√≠: ["Managing Assets" in the Developer's Guide](https://developers.google.com/earth-engine/asset_manager#importing-assets-to-your-script).


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// cargar un pol√≠gono de l√≠mite de cuenca (una base de datos vectorial p√∫blica ya en GEE)</span>
<span class="c1">// nota: v√©ase el tutorial mencionado arriba para obtener orientaci√≥n sobre la importaci√≥n de bases de datos de vectores</span>
<span class="kd">var</span> <span class="nx">watersheds</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">FeatureCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">users/hasencios/Cuencas_2012_gcs</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">watersheds</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">watersheds</span><span class="p">,</span> <span class="p">{},</span> <span class="dl">'</span><span class="s1">watersheds</span><span class="dl">'</span><span class="p">)</span></code></pre></figure>


<br>
<img src="../fig/03_wPeru.png" border = "10">
<br><br>

### La herramienta Inspector
La herramienta "Inspector" permite consultar las capas del mapa en un punto. Lo usaremos para ayudarnos a seleccionar una cuenca espec√≠fica. Para usar la herramienta "Inspector", haga clic en la pesta√±a "Inspector" en el panel superior derecho para activarla. Luego haga clic en cualquier lugar dentro del Visor de Mapas. Se mostrar√°n las coordenadas de su clic, junto con el valor de las capas del mapa en ese punto.

Podemos usar esto para encontrar el atributo "name" de nuestra cuenca de inter√©s (¬°elige la que quieras!).

<br>
<img src="../fig/03_inspectorN.png" border = "10">
<br><br>

Una vez que hayas determinado la propiedad "name" de tu cuenca, usa la funci√≥n featureCollection.filterMetadata() para extraer esta cuenca de la base de datos completa.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// use la herramienta del inspector para encontrar el nombre de una cuenca que le interese</span>
<span class="kd">var</span> <span class="nx">watershed</span> <span class="o">=</span> <span class="nx">watersheds</span><span class="p">.</span><span class="nx">filterMetadata</span><span class="p">(</span><span class="dl">'</span><span class="s1">NOMBRE</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">equals</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Cuenca Mantaro</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// imprima la metadata de la cuenca</span>
<span class="nx">print</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cuenca Mantaro</span><span class="dl">'</span><span class="p">,</span><span class="nx">watershed</span><span class="p">);</span>

<span class="c1">// establecer la vista del mapa y el zoom, y a√±adir la l√≠nea divisoria de aguas al mapa</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">centerObject</span><span class="p">(</span><span class="nx">watershed</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">watershed</span><span class="p">,{},</span><span class="dl">'</span><span class="s1">Cuencas Mantaro</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>


Cuenca de inter√©s: Mantaro
<br>
<img src="../fig/03_mantaro.png" border = "10">
<br><br>


### Filtrar una Image Collection
Aqu√≠, estamos seleccionando todas las im√°genes en el [Landsat 8 Surface Reflectance collection](https://code.earthengine.google.com/dataset/LANDSAT/LC08/C01/T1_SR) adquirido sobre nuestra cuenca de inter√©s.

*Consejo: Los ID de las Image collection se encuentran en la barra de herramientas de "Search" en la parte superior del editor de c√≥digos o a trav√©s de la b√∫squeda en el [data archive](https://code.earthengine.google.com/datasets/).*


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// cargue todas las im√°genes Landsat 8 SR dentro de los l√≠mites del pol√≠gono para el a√±o 2017</span>
<span class="kd">var</span> <span class="nx">l8collection</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">LANDSAT/LC08/C01/T1_SR</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterBounds</span><span class="p">(</span><span class="nx">watershed</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="dl">'</span><span class="s1">2017-01-01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">2017-12-31</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">l8collection</span><span class="p">);</span></code></pre></figure>


Imprimir nuestra colecci√≥n filtrada en la consola nos dice cu√°ntas im√°genes hay en nuestro filtro (148) as√≠ como los nombres de las bandas y las propiedades de las im√°genes de nuestra colecci√≥n:
<br>
<img src="../fig/03_collectionN.png" border = "10" width="50%" height="50%">
<br><br>

### Aplicar funciones
Como puedes ver al navegar por la pesta√±a `Docs` en el panel superior izquierdo del Code Editor, hay funciones GEE espec√≠ficas para los tipos de datos `Image` y `ImageCollection`. Hay muchas, incluyendo operadores matem√°ticos y booleanos, convoluciones y estad√≠sticas focales, y transformaciones espectrales y an√°lisis de textura espacial. Navegue por la lista, o lea sobre las operaciones generales disponibles en el [GEE Developer's Guide "Image Overview"" section](https://developers.google.com/earth-engine/image_overview).

A menudo, queremos usar una funci√≥n sobre cada imagen de una Image Collection. Para ello, necesitamos esencialmente "hacer un bucle" a trav√©s de cada imagen de la colecci√≥n de im√°genes. En GEE, los "bucles" se realizan con la funci√≥n .map().


**Evitar los bucles reales a toda costa.** Usar un bucle for lleva la operaci√≥n al navegador (mala pr√°ctica). Usando imageCollection.map() env√≠a la operaci√≥n a los servidores de Google para las ejecuciones distribuidas (buena pr√°ctica). Los bucles implementados de forma t√≠pica para la sentencia for, llevan la operaci√≥n al navegador, y no funcionan bien, si es que funciona.

Se puede encontrar m√°s informaci√≥n sobre la aplicaci√≥n de funciones a las Image collection [here in the Developer's Guide](https://developers.google.com/earth-engine/ic_mapping).

El concepto .map() se aplica tambi√©n a las `featureCollections` - para aplicar una funci√≥n a cada caracter√≠stica de una colecci√≥n, aplicamos esa funci√≥n a trav√©s de la featureCollection con la featureCollection.map(). Ver ["Mapping over a Feature Collection"](https://developers.google.com/earth-engine/feature_collection_mapping) en la Gu√≠a del Desarrollador.

### Enmascarar nubes
Aqu√≠, haremos uso de la banda `pixel_qa` que se proporciona con los productos SR para enmascarar los p√≠xeles con nubes, sombras de nubes y nieve. Enmascararemos los p√≠xeles de la imagen bas√°ndonos en el valor de pixel_qa.

Definimos expl√≠citamente una nueva funci√≥n llamada "maskClouds" y la aplicamos a cada imagen de la imageCollection utilizando `imageCollection.map()`. Las funciones necesitan expl√≠citamente **return** la salida final.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Enmascarar p√≠xeles con nubes y sombras de nubes -------------------------------------</span>

<span class="c1">// Los productos de reflectancia superficial vienen con una banda 'pixel_qa'.</span>
<span class="c1">// que se basa en la cfmask. Lea m√°s aqu√≠:</span>
<span class="c1">// https://landsat.usgs.gov/landsat-surface-reflectance-quality-assessment</span>

<span class="c1">// crear la funci√≥n de enmascarar nubes, sombras de nubes, nieve</span>
<span class="kd">var</span> <span class="nx">maskClouds</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>
  <span class="c1">// make a new single band image from the pixel qa band</span>
  <span class="kd">var</span> <span class="nx">pixel_qa</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">pixel_qa</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// keep clear (0) and water (1) pixels</span>
  <span class="k">return</span> <span class="nx">image</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">pixel_qa</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mi">322</span><span class="p">));</span>   
<span class="p">};</span>

<span class="c1">// usar "map" para aplicar la funci√≥n a cada imagen de la colecci√≥n</span>
<span class="kd">var</span> <span class="nx">l8masked</span> <span class="o">=</span> <span class="nx">l8collection</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">maskClouds</span><span class="p">);</span>

<span class="c1">// visualizar la primera imagen de la colecci√≥n, antes y despu√©s de la m√°scara</span>
<span class="kd">var</span> <span class="nx">visParams</span> <span class="o">=</span> <span class="p">{</span><span class="na">bands</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B2</span><span class="dl">'</span><span class="p">],</span> <span class="na">min</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}</span>

<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8masked</span><span class="p">.</span><span class="nx">first</span><span class="p">()),</span> <span class="nx">visParams</span><span class="p">,</span> <span class="dl">'</span><span class="s1">clouds masked</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8collection</span><span class="p">.</span><span class="nx">first</span><span class="p">()),</span> <span class="nx">visParams</span><span class="p">,</span> <span class="dl">'</span><span class="s1">original</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span></code></pre></figure>


<br>
<img src="../fig/03_maskedN.png" border = "10">
<br><br>

### Calcular el √≠ndice NDVI como una nueva banda
Del mismo modo, si queremos calcular el NDVI en cada imagen y a√±adirlo como una nueva banda, tenemos que crear una funci√≥n y mapearla sobre la colecci√≥n. Aqu√≠, usamos la funci√≥n `normalizedDifference()`. [Mathematical Operations page in the GEE Developer's Guide](https://developers.google.com/earth-engine/image_math) proporciona m√°s informaci√≥n sobre c√°lculos raster simples y complejos.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// crear una funci√≥n para a√±adir el NDVI usando la banda NIR (B5) y roja (B4)</span>
<span class="kd">var</span> <span class="nx">getNDVI</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">img</span><span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">normalizedDifference</span><span class="p">([</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">]).</span><span class="nx">rename</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">));</span>
<span class="p">};</span>

<span class="c1">// ejemplo extra: una funci√≥n equivalente usando √°lgebra de mapas</span>
<span class="kd">var</span> <span class="nx">getNDVI2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">img</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">img</span><span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">divide</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B5</span><span class="dl">'</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">))));</span>
<span class="p">};</span>

<span class="c1">// aplicar la funci√≥n sobre la image collection</span>
<span class="kd">var</span> <span class="nx">l8ndvi</span> <span class="o">=</span> <span class="nx">l8masked</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getNDVI</span><span class="p">);</span>

<span class="c1">// imprime una imagen para ver que la banda est√° ahora all√≠</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">first</span><span class="p">()));</span></code></pre></figure>


### Crear un Composite "Greenest Pixel"
Ahora necesitamos reunir la Image Collection para crear una imagen continua a trav√©s de la cuenca. Hay varias opciones de mosaico/composici√≥n disponibles, desde simples composiciones de valor m√°ximo (`imageCollection.max()`) y mosaicos sencillos con la imagen m√°s reciente (`imageCollection.mosaic()`).   [Compositing and Mosaicking page on the Developer's Guide](https://developers.google.com/earth-engine/ic_composite_mosaic) proporciona ejemplos de estos.

Aqu√≠, usaremos la funci√≥n `imageCollection.qualityMosaic()`. Al priorizar la imagen a utilizar en base a una banda espec√≠fica, este m√©todo asegura que los valores de todas las bandas se tomen de la misma imagen. A cada p√≠xel se le asignan los valores de la imagen con el valor m√°s alto de la banda deseada.

Usaremos esto para hacer un "greenest pixel composite" para nuestra cuenca basado en la banda del NDVI que acabamos de calcular. La imagen compuesta final retendr√° todas las bandas en la entrada (a menos que especifiquemos lo contrario). Cada p√≠xel en la imagen compuesta podr√≠a potencialmente provenir de im√°genes adquiridas en fechas diferentes, pero todas las bandas dentro de cada p√≠xel son de la misma imagen. En general, esto proporciona la mejor instant√°nea disponible del paisaje en el pico de la temporada de crecimiento, independientemente del momento fenol√≥gico dentro del a√±o.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// para cada pixel, seleccione el "mejor" conjunto de bandas de las im√°genes disponibles</span>
<span class="c1">// basado en el m√°ximo NDVI/greenness</span>
<span class="kd">var</span> <span class="nx">composite</span> <span class="o">=</span> <span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">qualityMosaic</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">).</span><span class="nx">clip</span><span class="p">(</span><span class="nx">watershed</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">composite</span><span class="p">);</span>

<span class="c1">// Visualizar el NDVI</span>
<span class="kd">var</span> <span class="nx">ndviPalette</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">FFFFFF</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">CE7E45</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">DF923D</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">F1B555</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">FCD163</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">99B718</span><span class="dl">'</span><span class="p">,</span>
               <span class="dl">'</span><span class="s1">74A901</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">66A000</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">529400</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">3E8601</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">207401</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">056201</span><span class="dl">'</span><span class="p">,</span>
               <span class="dl">'</span><span class="s1">004C00</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">023B01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">012E01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">011D01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">011301</span><span class="dl">'</span><span class="p">];</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">composite</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
            <span class="p">{</span><span class="na">min</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">palette</span><span class="p">:</span> <span class="nx">ndviPalette</span><span class="p">},</span> <span class="dl">'</span><span class="s1">ndvi</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>


El m√°ximo anual de NDVI a trav√©s de esta cuenca hidrogr√°fica destaca las zonas altoandinas con presencia de suelo desnudo y en las cercan√≠as la selva, los m√°s verdes :

<br>
<img src="../fig/03_ndviN.png" border = "10">
<br><br>

Tambi√©n podemos usar esta imagen compuesta para visualizar una composici√≥n de color verdadero usando las bandas RGB:


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Visualizar el compuesto en color verdadero </span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">composite</span><span class="p">,</span> <span class="p">{</span><span class="na">bands</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">B4</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">B3</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">B2</span><span class="dl">'</span><span class="p">],</span> <span class="na">min</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span> <span class="mi">2000</span><span class="p">},</span> <span class="dl">'</span><span class="s1">true color composite</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></code></pre></figure>


<br>
<img src="../fig/03_tccN.png" border = "10">
<br><br>

### Visualizar los resultados en un gr√°fico
Para ilustrar brevemente la capacidad de GEE de generar gr√°ficos de datos, cargamos el producto de datos MODIS NDVI para trazar la serie temporal anual de NDVI medio de nuestra cuenca. La generaci√≥n de gr√°ficos tambi√©n est√° cubierto en el [m√≥dulo 04 Reductores espaciales y temporales](https://hasencios.github.io/GEE_BASICO_SENAMHI/04-reducers/).


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Gr√°fico de series temporales anuales del NDVI medio en la cuenca</span>
<span class="c1">// de nuestro compuesto calculado de Landsat 8</span>
<span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">series</span><span class="p">({</span>
    <span class="na">imageCollection</span><span class="p">:</span> <span class="nx">l8ndvi</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span>  <span class="c1">//** Puede exportar la figura o los datos en la ventana</span>


<span class="c1">// Tambi√©n se puede comparar con el producto MODIS de 16 d√≠as</span>

<span class="c1">// a√±adir series temporales de sat√©lites: producto MODIS NDVI 250m de 16 d√≠as</span>
<span class="kd">var</span> <span class="nx">modis</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">MODIS/006/MOD13Q1</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterBounds</span><span class="p">(</span><span class="nx">watershed</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="dl">'</span><span class="s1">2017-01-01</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">2017-12-31</span><span class="dl">'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Gr√°fico de series temporales anuales del NDVI medio en la cuenca</span>
<span class="c1">// del producto suavizado MODIS 16 d√≠as</span>
<span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">series</span><span class="p">({</span>
    <span class="na">imageCollection</span><span class="p">:</span> <span class="nx">modis</span><span class="p">,</span>
    <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span>
<span class="p">})</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span></code></pre></figure>


Tenga en cuenta que puede exportar los datos subyacentes del gr√°fico mediante el icono de la flecha que aparece...
<br>
<img src="../fig/03_chartN.png" border = "10" width="90%" height="90%">
<br><br>

### Exportar los resultados como una Table
La manera m√°s eficiente de obtener datos de GEE es en una tabla. Esta forma tiene el beneficio de estar codificada y por lo tanto ser totalmente reproducible. Exportar tablas tambi√©n requiere mucha menos potencia de c√°lculo que exportar una imagen completa. Cuando realices un an√°lisis, piensa bien en c√≥mo puedes dejar el raster en la nube y extraer los datos que necesitas como una matriz.


<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Use los botones de la tabla emergente para exportar el .csv, o puede hacer un gui√≥n</span>
<span class="c1">// la exportaci√≥n como sigue utilizando un reductor:</span>

<span class="c1">// obtener el valor medio de la regi√≥n de cada imagen</span>
<span class="kd">var</span> <span class="nx">ts</span> <span class="o">=</span> <span class="nx">modis</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">system:time_start</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mean</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">reduceRegion</span><span class="p">({</span>
    <span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">mean</span><span class="p">(),</span>
    <span class="na">geometry</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">,</span>
    <span class="na">scale</span><span class="p">:</span> <span class="mi">250</span>
  <span class="p">});</span>
  <span class="c1">// y devuelve una caracter√≠stica con geometr√≠a 'null' con propiedades (dictionary)  </span>
  <span class="k">return</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">mean</span><span class="dl">'</span><span class="p">:</span> <span class="nx">mean</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">),</span>
                            <span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">:</span> <span class="nx">date</span><span class="p">})</span>
<span class="p">});</span>

<span class="c1">// Exportar una tabla de fecha .csv, media NDVI para la cuenca</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">table</span><span class="p">.</span><span class="nx">toDrive</span><span class="p">({</span>
  <span class="na">collection</span><span class="p">:</span> <span class="nx">ts</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_MODIS_NDVI_stats</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">folder</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GEE_SENAMHI</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">fileFormat</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CSV</span><span class="dl">'</span>
<span class="p">});</span>

<span class="c1">// Y PULSE "RUN" EN LA PESTA√ëA DE TAREAS EN EL PANEL SUPERIOR DERECHO</span></code></pre></figure>


Para ejecutar las tareas de exportar, debes ir a la pesta√±a 'Tasks' en el panel superior derecho y presionar 'Run'.

<br>
<img src="../fig/03_runTask.png" border = "10" width="50%" height="50%">
<br><br>

### Exportar Images
Los usuarios pueden exportar los resultados de sus manipulaciones de im√°genes a su carpeta de activos de GEE para su uso posterior dentro de la plataforma o a sus cuentas personales de Google Drive o de Google Cloud Storage. Aqu√≠, exportaremos una imagen de una sola banda de NDVI m√°ximo anual para nuestra cuenca. Se proporcionaran ejemplos para exportar a Google Drive. Se puede encontrar m√°s informaci√≥n sobre exportar
 [here in the Developers Guide](https://developers.google.com/earth-engine/exporting).

En la API de JavaScript, lo que se quiera exportar se env√≠a a la pesta√±a 'Tasks' en el panel superior derecho. Para evitar que los usuarios inunden el sistema inadvertidamente con tareas gratuitas y accidentales, es necesario ejecutar expl√≠citamente la tarea individualmente desde la pesta√±a 'Task'. Puede cambiar los nombres de los archivos y otros par√°metros aqu√≠, si es necesario, o codificarlos en su script.

Al exportar a Google Drive, GEE encontrar√° la carpeta con el nombre especificado y no necesita la ruta de archivo completa. Si esta carpeta a√∫n no existe, la crear√° en tu unidad.



<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// La exportaci√≥n es innecesaria, pero aqu√≠ est√°n los ejemplos de c√≥digo para salvar un</span>
<span class="c1">// imagen compuesta si se desea.  </span>

<span class="c1">// seleccione s√≥lo la banda de ndvi</span>
<span class="kd">var</span> <span class="nx">ndvi</span> <span class="o">=</span> <span class="nx">composite</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">NDVI</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Ejemplo de exportaci√≥n a Google Drive</span>
<span class="c1">// (nota: hay que pulsar 'Run' en la pesta√±a de tareas en el panel superior derecho)</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">toDrive</span><span class="p">({</span>
  <span class="na">image</span><span class="p">:</span> <span class="nx">ndvi</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scale</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">.</span><span class="nx">geometry</span><span class="p">().</span><span class="nx">bounds</span><span class="p">(),</span> <span class="c1">// .geometry().bounds() needed for multipolygon</span>
  <span class="na">crs</span><span class="p">:</span> <span class="dl">'</span><span class="s1">EPSG:5070</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">folder</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GEE_SENAMHI</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">maxPixels</span><span class="p">:</span> <span class="mi">2000000000</span>
<span class="p">});</span>

<span class="c1">// Ejemplo de exportaci√≥n de una carpeta de assets</span>
<span class="c1">// (nota: hay que pulsar 'Run' en la pesta√±a de tareas en el panel superior derecho)</span>
<span class="nx">Export</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">toAsset</span><span class="p">({</span>
  <span class="na">image</span><span class="p">:</span> <span class="nx">ndvi</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">assetId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users/yourname/SENAMHI_2017_L8_NDVI_image</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">scale</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="na">region</span><span class="p">:</span> <span class="nx">watershed</span><span class="p">.</span><span class="nx">geometry</span><span class="p">().</span><span class="nx">bounds</span><span class="p">(),</span>
  <span class="na">pyramidingPolicy</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">.default</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">mean</span><span class="dl">'</span><span class="p">},</span> <span class="c1">// use {'.default':'sample'} for discrete data</span>
  <span class="na">maxPixels</span><span class="p">:</span> <span class="mi">2000000000</span>
<span class="p">});</span></code></pre></figure>


Se puede acceder a una versi√≥n est√°tica del script aqu√≠: [https://code.earthengine.google.com/8418ba2b48095a765720d79982bcfab7](https://code.earthengine.google.com/8418ba2b48095a765720d79982bcfab7)
-->
:ET